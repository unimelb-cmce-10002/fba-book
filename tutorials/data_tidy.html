<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Foundations of Business Analytics - Tutorial 5: Shaping and Joining Data for Business Analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../tutorials/data_wrangling.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="../solution.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/what_is_business_analytics.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../tutorials/data_tidy.html">Tutorial 5: Shaping and Joining Data for Business Analytics</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Foundations of Business Analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../foundations/what_is_business_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What is Business Analytics?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../foundations/how_to_do_business_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Core Skills of a “Business Scientist”</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../foundations/reproducible.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reproducible Workflows with R &amp; Posit Cloud</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Getting Our First Insights from Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../insights/data_visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualisation for Business Intelligence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../insights/data_manipulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Wrangling for Business Analytics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../insights/data_tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Shaping and Combining Data for Business Analytics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/what_is_business_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 1: Business Analytics Skills for Inventory Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/how_to_do_business_analytics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 2: Core Skills of a Business Scientist &amp; Introduction to Posit Cloud</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/data_visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 3: Data Visualisation for Business Intelligence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/data_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 4: Data Wrangling for Business Analytics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/data_tidy.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tutorial 5: Shaping and Joining Data for Business Analytics</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-business-challenge" id="toc-the-business-challenge" class="nav-link active" data-scroll-target="#the-business-challenge">The Business Challenge</a>
  <ul class="collapse">
  <li><a href="#the-topic-how-well-do-australian-firms-earnings-explain-what-investors-are-willing-to-pay-for-these-companies" id="toc-the-topic-how-well-do-australian-firms-earnings-explain-what-investors-are-willing-to-pay-for-these-companies" class="nav-link" data-scroll-target="#the-topic-how-well-do-australian-firms-earnings-explain-what-investors-are-willing-to-pay-for-these-companies">The Topic: How well do Australian firms’ earnings explain what investors are willing to pay for these companies?</a></li>
  <li><a href="#the-data-stock-price-data-from-yahoo-finance" id="toc-the-data-stock-price-data-from-yahoo-finance" class="nav-link" data-scroll-target="#the-data-stock-price-data-from-yahoo-finance">The Data: Stock Price Data from Yahoo Finance</a></li>
  <li><a href="#the-data-share-prices-and-earnings" id="toc-the-data-share-prices-and-earnings" class="nav-link" data-scroll-target="#the-data-share-prices-and-earnings">The Data: Share Prices and Earnings</a></li>
  <li><a href="#the-method-shaping-and-combining-data-with-tidyr-and-dplyr" id="toc-the-method-shaping-and-combining-data-with-tidyr-and-dplyr" class="nav-link" data-scroll-target="#the-method-shaping-and-combining-data-with-tidyr-and-dplyr">The Method: Shaping and Combining Data with <code>tidyr</code> and <code>dplyr</code></a></li>
  <li><a href="#getting-set-up-and-loading-the-data" id="toc-getting-set-up-and-loading-the-data" class="nav-link" data-scroll-target="#getting-set-up-and-loading-the-data">Getting set up and loading the data</a></li>
  </ul></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">Loading the Data</a>
  <ul class="collapse">
  <li><a href="#r-packages-for-today" id="toc-r-packages-for-today" class="nav-link" data-scroll-target="#r-packages-for-today">R packages for today</a></li>
  </ul></li>
  <li><a href="#prepare-these-exercises-before-class" id="toc-prepare-these-exercises-before-class" class="nav-link" data-scroll-target="#prepare-these-exercises-before-class">Prepare these Exercises before Class</a>
  <ul class="collapse">
  <li><a href="#exercise-1-identifying-issues-with-un-tidy-data" id="toc-exercise-1-identifying-issues-with-un-tidy-data" class="nav-link" data-scroll-target="#exercise-1-identifying-issues-with-un-tidy-data">Exercise 1: Identifying Issues with Un-tidy Data</a></li>
  <li><a href="#exercise-2-combining-datasets" id="toc-exercise-2-combining-datasets" class="nav-link" data-scroll-target="#exercise-2-combining-datasets">Exercise 2: Combining Datasets</a></li>
  <li><a href="#exercise-3-tidying-and-unlocking-scalable-insights" id="toc-exercise-3-tidying-and-unlocking-scalable-insights" class="nav-link" data-scroll-target="#exercise-3-tidying-and-unlocking-scalable-insights">Exercise 3: Tidying and Unlocking Scalable Insights</a></li>
  <li><a href="#exercise-4-whats-missing-understanding-joins-by-seeing-what-they-drop" id="toc-exercise-4-whats-missing-understanding-joins-by-seeing-what-they-drop" class="nav-link" data-scroll-target="#exercise-4-whats-missing-understanding-joins-by-seeing-what-they-drop">Exercise 4: What’s Missing? Understanding Joins by Seeing What They Drop</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 5: Shaping and Joining Data for Business Analytics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Goals
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this tutorial, you should be able to:</p>
<ul>
<li>Recognize the difference between tidy and messy data, and use <code>pivot_longer()</code> to tidy up wide data.</li>
<li>Summarize and visualise financial data, and explain why tidy formats make analysis easier.</li>
<li>Plot and interpret relationships between share price and earnings per share (EPS).</li>
<li>Combine data from multiple tables using joins (<code>left_join()</code>, <code>inner_join()</code>, <code>anti_join()</code>), and understand what each join includes or excludes.</li>
</ul>
</div>
</div>
<section id="the-business-challenge" class="level2">
<h2 class="anchored" data-anchor-id="the-business-challenge">The Business Challenge</h2>
<section id="the-topic-how-well-do-australian-firms-earnings-explain-what-investors-are-willing-to-pay-for-these-companies" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="the-topic-how-well-do-australian-firms-earnings-explain-what-investors-are-willing-to-pay-for-these-companies">The Topic: How well do Australian firms’ earnings explain what investors are willing to pay for these companies?</h3>
<p>Share prices of Australia’s biggest companies go up and down every day. These changes reflect how investors feel about the company’s future earnings — based on news, forecasts, and the broader economy.</p>
<p>Two key numbers help us understand this:</p>
<p>Earnings per share (EPS), tells us how much profit a company earns for each share:</p>
<p><span class="math display">\[
\text{EPS} = \frac{\text{Profit}}{\text{Shares Outstanding}}
\]</span></p>
<p>The Price-to-Earnings (P/E) Ratio shows how much investors are willing to pay for $1 of earnings:</p>
<p><span class="math display">\[
\text{P/E} = \frac{\text{Share Price}}{\text{EPS}}
\]</span></p>
<p>To tie these measures back to our earlier material on firm’s Earnings Before Interest and Taxes (EBIT), we can define firm’s earnings that are ultimately paid out to shareholders as follows:</p>
<p><span class="math display">\[
\text{Earnings} = \text{EBIT} - \text{Interest} - \text{Taxes}
\]</span></p>
<p>We’ll use real data from major Australian companies listed on the ASX to practise cleaning, combining, and analysing financial variables like EPS and the P/E ratio. In particular we will:</p>
<ul>
<li>Tidy messy financial data</li>
<li>Join multiple datasets together</li>
</ul>
</section>
<section id="the-data-stock-price-data-from-yahoo-finance" class="level3">
<h3 class="anchored" data-anchor-id="the-data-stock-price-data-from-yahoo-finance">The Data: Stock Price Data from Yahoo Finance</h3>
<p>Here’s a simplified and more student-friendly version:</p>
<hr>
</section>
<section id="the-data-share-prices-and-earnings" class="level3">
<h3 class="anchored" data-anchor-id="the-data-share-prices-and-earnings">The Data: Share Prices and Earnings</h3>
<p>We’ll be using real data on Australian companies from Yahoo Finance. It includes key financial info:</p>
<ul>
<li><code>gvkey</code>: a unique company ID we can use to match data across files</li>
<li><code>price</code>: each company’s share price at the end of the year</li>
<li><code>eps</code>: earnings per share – how much profit each share earns</li>
<li><code>pe</code>: price-to-earnings ratio – how much investors are paying per dollar of earnings</li>
</ul>
<p>We also have a separate file with industry details:</p>
<ul>
<li><code>gsubind</code>: a code showing what industry a company is in</li>
<li><code>subind</code>: the name of that industry (like “Gold” or “Construction &amp; Engineering”)</li>
</ul>
<p>Together, these files let us compare company valuations and see how they differ across industries.</p>
</section>
<section id="the-method-shaping-and-combining-data-with-tidyr-and-dplyr" class="level3">
<h3 class="anchored" data-anchor-id="the-method-shaping-and-combining-data-with-tidyr-and-dplyr">The Method: Shaping and Combining Data with <code>tidyr</code> and <code>dplyr</code></h3>
<p>Data often needs cleaning before it’s ready to analyse. It might be too wide (with different years in separate columns), too long, or split across multiple files.</p>
<p>In this tutorial, we’ll use two tidyverse tools to fix that:</p>
<ul>
<li><strong><code>tidyr</code></strong>: to reshape messy data using functions like <code>pivot_longer()</code></li>
<li><strong><code>dplyr</code></strong>: to join different datasets together and spot what’s missing</li>
</ul>
<p>These tools will help us:</p>
<ul>
<li>Make messy data easier to work with</li>
<li>Combine company data with industry labels</li>
</ul>
</section>
<section id="getting-set-up-and-loading-the-data" class="level3">
<h3 class="anchored" data-anchor-id="getting-set-up-and-loading-the-data">Getting set up and loading the data</h3>
</section>
</section>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the Data</h2>
<section id="r-packages-for-today" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="r-packages-for-today">R packages for today</h3>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-3_840c49e9d0d357b8174eef8511e0a7fe">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)     <span class="co"># collection of packages for data manipulation and visualization</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="prepare-these-exercises-before-class" class="level2">
<h2 class="anchored" data-anchor-id="prepare-these-exercises-before-class">Prepare these Exercises before Class</h2>
<p>Prepare these exercises before coming to class. Plan to spend 45 minutes on these exercises.</p>
<p>::: {.callout-important title = “Switch on the <code>eval</code> flag when you want to evaluate code!”} In the R code chunks below we have provided starter code for you to work from. We have set the key <code>eval</code> to the value <code>false</code> so that they are not run because they have syntax such as <code>YOUR_VALUE_HERE</code> which would generate errors.</p>
<p>Switch the <code>eval</code> value to <code>true</code> when you want the R code within a chunk to be run when you compile your document. :::</p>
<section id="exercise-1-identifying-issues-with-un-tidy-data" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-identifying-issues-with-un-tidy-data">Exercise 1: Identifying Issues with Un-tidy Data</h3>
<p>We’ll start with a deliberately messy version of the ASX stock price data. Run the following code to load and implement some preliminary manipulations to this dataset.</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-4_969e1168e4c9e5c029d365b66e623617">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>asx_prices_messy <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="st">"data/asx_prices_messy.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-5_a38d9bfe1f761bb3c1b00731685cc434">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>asx_prices_messy <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(gvkey, conm, price_2023, price_2024, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>           eps_2023, eps_2024) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   gvkey  conm                      price_2023 price_2024 eps_2023 eps_2024
   &lt;chr&gt;  &lt;chr&gt;                          &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 327267 1414 DEGREES LTD               0.04       0.067  -0.0091  -0.0107
 2 349318 29METALS LIMITED               0.375     NA      -0.799   NA     
 3 284698 3D ENERGI LIMITED              0.056      0.07    0.0129  -0.0075
 4 317959 3P LEARNING LTD                1.27       1.02    0.023   -0.208 
 5 339106 4DMEDICAL LTD                  0.45       0.675  -0.105   -0.0971
 6 314650 4DS MEMORY LTD                 0.135      0.084  -0.0038  -0.0031
 7 324960 5E ADVANCED MATERIALS INC      2.26       0.54   -0.7     -1.18  
 8 325746 5G NETWORKS LIMITED            0.125      0.148  -0.0579  -0.0836
 9 253429 88 ENERGY LTD                  0.005     NA      -0.0006  NA     
10 323980 8COMMON LTD                    0.075      0.041  -0.0147  -0.0114</code></pre>
</div>
</div>
<p><strong>(a).</strong> In what ways is this data frame not tidy? Be specific: which tidy‑data principles are violated?</p>
<p><strong>(b).</strong> Suppose we want the average share price across all firms for the period 2023–2024. With this messy layout you will need to compute sum and counts across columns (i.e., sum prices for 2023, for 2024; then, count non-missing observations in these columns for 2023, 2024, etc). Use the starter code below to compute the average share price across all firms for the period 2023-2024.</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-6_288b22d48b84b0fbc860e2a9db830eb6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>asx_prices_messy <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sum the prices from the 2023 year</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">sum_prices_2023   =</span> <span class="fu">sum</span>(YOUR_CODE_HERE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sum the prices from the 2024 year</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">sum_prices_2024   =</span> <span class="fu">sum</span>(YOUR_CODE_HERE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Count the number of firms with non-missing</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># prices in 2023</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">count_firms_2023 =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(price_2023)),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Count the number of firms with non-missing</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># prices in 2024</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">count_firms_2024 =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(price_2024))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the total sum of prices across both years</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_sum   =</span> YOUR_CODE_HERE <span class="sc">+</span> YOUR_CODE_HERE,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the total count of firms across both years</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_count =</span> count_firms_2023 <span class="sc">+</span> count_firms_2024</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Manually compute the average</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">avg_price_23_24 =</span> YOUR_CODE_HERE <span class="sc">/</span> YOUR_CODE_HERE</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(avg_price_23_24)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(c)</strong> Explain why the approach we took in (b) doesn’t scale well as more years of data are added.</p>
<p><strong>(d)</strong> Examining relationships between variables in a messy data frame can be especially tricky. Suppose we want to see whether share price and earnings per share are correlated in 2024. With this messy structure we must hard-code the year’s columns:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-7_e09e9aab218cbe59415e25b8ccab9934">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>asx_prices_messy <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(eps_2024 <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> eps_2024, <span class="at">y =</span> price_2024)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Share Price vs EPS (2024)"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Earnings per Share (EPS, 2024)"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Share Price (2024)"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="data_tidy_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on this plot, what relationship do you see in 2024? Why does this make sense economically (what are investors “buying” when they invest)?</p>
<p><strong>(e)</strong>. Now imagine you also wanted to include 2023 in the same analysis. You do not need to implement code to add these data points to the plot above — just explain the steps you’d need to take.</p>
<ul>
<li>Which additional columns would you need to reference in the data?</li>
<li>How would your plotting code change?</li>
<li>What problems do you foresee if you wanted to extend this further to 2019–2024?</li>
</ul>
</section>
<section id="exercise-2-combining-datasets" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-combining-datasets">Exercise 2: Combining Datasets</h3>
<p>In this exercise, we’ll combine two or more data frames using joins. Sometimes, joining adds columns. Other times, it can add rows when duplicate keys exist.</p>
<p>Let’s walk through both situations.</p>
<p>To start, let’s load the necessary data for this exercise - for two of these datasets, the code below also does some ‘light’ wrangling (similar to what we did to our datasets in last week’s tutorial):</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-8_16094f843627b0eed4847c06ed0a5d04">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>firm_codes <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="st">"data/asx_200_2024.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(gvkey, conm, gsubind)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>subindustry_names <span class="ot">&lt;-</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="st">"data/GICS_subindustry.csv"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>pe_data <span class="ot">&lt;-</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_csv</span>(<span class="st">"data/pe.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(gvkey, fyear, pe) <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(pe)) <span class="sc">|&gt;</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(gvkey, fyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(a)</strong>. We start with a data frame that lists each firm’s subindustry code (<code>gsubind</code>), using the largest 200 firms on the ASX in 2024:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-9_2c05c13b458f35a2d48717697014ad94">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>firm_codes <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   gvkey  conm                    gsubind
   &lt;chr&gt;  &lt;chr&gt;                     &lt;dbl&gt;
 1 013312 BHP GROUP LTD          15104020
 2 210216 TELSTRA GROUP LIMITED  50101020
 3 223003 CSL LTD                35201010
 4 212650 TRANSURBAN GROUP       20305020
 5 100894 WOOLWORTHS GROUP LTD   30101030
 6 212427 FORTESCUE LTD          15104050
 7 101601 WESFARMERS LTD         25503030
 8 226744 RAMSAY HEALTH CARE LTD 35102020
 9 220244 QANTAS AIRWAYS LTD     20302010
10 017525 ORIGIN ENERGY LTD      55101010</code></pre>
</div>
</div>
<p>We also have a lookup table that tells us the name of each subindustry:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-10_dd8f318773bdfbc087d2cce1882286ad">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>subindustry_names <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
    gsubind subind                              
      &lt;dbl&gt; &lt;chr&gt;                               
 1 10101010 Oil &amp; Gas Drilling                  
 2 10101020 Oil &amp; Gas Equipment &amp; Services      
 3 10102010 Integrated Oil &amp; Gas                
 4 10102020 Oil &amp; Gas Exploration &amp; Production  
 5 10102030 Oil &amp; Gas Refining &amp; Marketing      
 6 10102040 Oil &amp; Gas Storage &amp; Transportation  
 7 10102050 Coal &amp; Consumable Fuels             
 8 15101010 Commodity Chemicals                 
 9 15101020 Diversified Chemicals               
10 15101030 Fertilizers &amp; Agricultural Chemicals</code></pre>
</div>
</div>
<p>Use a left join to add the subindustry name to each firm in the <code>firm_codes</code> dataset using the variable <code>gsubind</code> as the join key. The code below gets you started:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-11_de5d312b68043046f64de2e81ad98c4b">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>firm_info <span class="ot">&lt;-</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    YOUR_DATASET_NAME <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(YOUR_DATASET_NAME, <span class="at">by =</span> <span class="st">"YOUR_VARIABLE_NAME"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>firm_info <span class="sc">|&gt;</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(b).</strong> What kind of join did we just perform? To help answer this question, consider the following:</p>
<ul>
<li>What kind of thing are we adding: columns or rows?</li>
<li>Did each <code>gsubind</code> only appear once in the dataset <code>subindustry_names</code>?</li>
<li>Does this kind of join have a name? If so, what is it?</li>
</ul>
<p><strong>(c)</strong>.</p>
<p>Now let’s bring in PE ratio data, which has multiple years per firm:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-12_d1cbaa10b477e9565fbf38a0f65825e8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pe_data <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   gvkey  fyear    pe
   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 005302  2008  41.7
 2 010991  2004  27.2
 3 010991  2005  41.8
 4 010991  2006  45.0
 5 010991  2007  29.7
 6 010991  2008 135. 
 7 010991  2021 979. 
 8 010991  2023  57.0
 9 013312  2005  21.3
10 013312  2006  14.8</code></pre>
</div>
</div>
<p>Use a left join to add the P/E data to each firm in the <code>firm_info</code> dataset using the variable <code>gvkey</code> as the join key. Use the starter code below to implement this join:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-13_4f3cb352990d97c97cfda178c057555b">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>firm_pe_data <span class="ot">&lt;-</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    YOUR_DATASET_NAME <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_JOIN_TYPE</span>(YOUR_DATASET_NAME, <span class="at">by =</span> <span class="st">"YOUR_VARIABLE_NAME"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>firm_pe_data <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pe, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(d).</strong> What kind of join did we just perform? To help answer this question, consider the following:</p>
<ul>
<li>What kind of thing are we adding: columns or rows?</li>
<li>How many rows are in the dataset <code>firm_pe_data</code>? How about <code>firm_info</code>?</li>
<li>Does each <code>gvkey</code> in the original table (<code>firm_info</code>) now appear once or multiple times in the ‘joined’ data frame (<code>firm_pe_data</code>)? Why?</li>
<li>Does this kind of join have a name? If so, what is it?</li>
</ul>
</section>
<section id="exercise-3-tidying-and-unlocking-scalable-insights" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3-tidying-and-unlocking-scalable-insights">Exercise 3: Tidying and Unlocking Scalable Insights</h3>
<p><strong>(a)</strong>. We’ll now tidy the messy stock price dataset from Exercise 1 so we can more easily analyse and visualise it. Use the starter code below to turn your wide-format data back into a tidy format using <code>pivot_longer()</code>.</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-14_163fc9e20acb040d7350cdc4513cd4cc">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>asx_prices_tidy <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    asx_prices_messy <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> YOUR_CODE_HERE,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"fyear"</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_sep =</span> YOUR_CODE_HERE,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_drop_na =</span> <span class="cn">TRUE</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fyear =</span> <span class="fu">as.numeric</span>(fyear))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>asx_prices_tidy <span class="sc">|&gt;</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(b)</strong>. Why is this structure better for analysis? Why might calculations or visualisations now be easier?</p>
<p><strong>(c)</strong>. Let’s re-do a simple tasks from Exercise 1, that was quite complicated to implement — and see how much easier it is now that our data is tidy. What’s the average share price for all firms across 2023 and 2024?</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-15_f2d96ad0f482829d57aae7eb295fdd14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>asx_prices_tidy <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(fyear <span class="sc">%in%</span> <span class="fu">c</span>(YOUR_YEARS)) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(<span class="at">avg_price =</span> <span class="fu">mean</span>(YOUR_VARIABLE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(d)</strong>. Let’s re-do our plot from Exercise 1 too. Plot price vs EPS over the full sample (2019–2024).</p>
<p><strong>(e)</strong>. Suppose we wanted to modify the plot in (d) to only include the years 2023 and 2024. Modify the code you just wrote to make this change by adding one new line of code.</p>
<p><strong>(f)</strong>. What kind of relationship do you observe in the plot in (d)? What might explain firms that lie above or below the fitted line? For EPS &lt; 0, does our line-of-best-fit ‘make sense’?</p>
</section>
<section id="exercise-4-whats-missing-understanding-joins-by-seeing-what-they-drop" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4-whats-missing-understanding-joins-by-seeing-what-they-drop">Exercise 4: What’s Missing? Understanding Joins by Seeing What They Drop</h3>
<p>In Exercise 2, we used <code>left_join()</code> to combine data from different tables — like firm details, subindustry names, and P/E ratios. That helped us build one data frame with all the information in one place. Now, we’ll go a step further and explore what different kinds of joins keep and drop. This can help us spot missing or underrepresented data — and understand our dataset more deeply.</p>
<p><strong>(a)</strong>. Let’s start by counting how many firms in the ASX200 belong to each subindustry. Use the starter code below to return the three most common industries:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-16_db6de53446e6891c0ce169b3183ddf48">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>firm_info <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(subind) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And, now the three least common:</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-17_191376e0a57270c04c67698aacc14265">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>firm_info <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(subind) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>((n)) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(b)</strong>. Are there any subindustries that don’t appear in the ASX200 sample-and so are even less common those that we identify in (a)?</p>
<p>We can use <code>anti_join()</code> to find subindustries listed in <code>subindustry_names</code> but missing from our firms data. How many subindustries are not included in the ASX200?</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-18_08df95c78c95f60a949a765e8575ed95">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>YOUR_CODE <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(firm_info, <span class="at">by =</span> <span class="st">"subind"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(c)</strong>. What kinds of industries are missing? Why might they be underrepresented in the ASX200?</p>
<p><strong>(d)</strong>. An <code>inner_join()</code> keeps only the firms that have a matching subindustry in the lookup table. Recreate the join you did in Exercise 2(a), but this time use <code>inner_join()</code> instead of <code>left_join()</code>.</p>
<div class="cell" data-hash="data_tidy_cache/html/unnamed-chunk-19_f4273cee72f8b5c118509f917d2f96b8">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>firm_info_inner <span class="ot">&lt;-</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    firm_codes <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">YOUR_CODE</span>(subindustry_names, <span class="at">by =</span> <span class="st">"gsubind"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>(e)</strong> Are there any differences in the data frame in (d) to the one you constructed in 2 (a)? Explain your answer.</p>
<p><strong>(f)</strong>. Over this exercise and Exercise 2, you’ve used three different types of joins:</p>
<ul>
<li><code>left_join()</code></li>
<li><code>anti_join()</code></li>
<li><code>inner_join()</code></li>
</ul>
<p>Each one gives you a slightly different view of how your data frames relate to each other.</p>
<p>In your own words, answer the following:</p>
<ol type="1">
<li>What does each join keep and what does it drop?</li>
<li>Which join is most useful when you want to preserve all rows from one table, even if they don’t match?</li>
<li>Which join is best for finding mismatches between two tables?</li>
<li>Which join only keeps perfect matches between the two tables?</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../tutorials/data_wrangling.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Tutorial 4: Data Wrangling for Business Analytics</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>